(function(m,v){"forEach"in Array.prototype||(Array.prototype.forEach=function(m,r){for(var l=0,t=this.length;l<t;l++)l in this&&m.call(r,this[l],l,this)});m.pciMVC=v()})(this,function(){var m={},v={textfield:PJF.ui.textfield,dateinput:PJF.ui.dateinput,selector:PJF.ui.select,auto:PJF.ui.autoComplete,radio:PJF.ui.radio},z={textfield:function(){},dateinput:function(){},selector:function(){var a=this;a.pjfAttr.categoryId&&new PJF.communication.getStandardCode({categoryId:a.pjfAttr.categoryId,appId:a.pjfAttr.appId,
clcd:a.pjfAttr.clcd,success:function(c){a.widget.addOptions(t(c,"selector"))}})},auto:function(){var a=this;a.pjfAttr.categoryId&&new PJF.communication.getStandardCode({categoryId:a.pjfAttr.categoryId,appId:a.pjfAttr.appId,clcd:a.pjfAttr.clcd,success:function(c){a.widget.addOptions(t(c,"auto"))}})},radio:function(){}},r=function(){var a={textfield:'<label id="label_{{:id}}">{{:desc}}:</label><input id="dom_{{:id}}" type="text"/>',dateinput:'<label id="label_{{:id}}">{{:desc}}:</label><input id="dom_{{:id}}" type="text"/>',
selector:'<label id="label_{{:id}}">{{:desc}}:</label><span id="dom_{{:id}}" />',auto:'<label id="label_{{:id}}">{{:desc}}:</label><input id="dom_{{:id}}" type="text"/>',radio:'<label id="label_{{:id}}">{{:desc}}:</label><span id="dom_{{:id}}" />',li:'<li id="{{:id}}_container" class="{{:li_class}}" style="{{:li_style}}">{{:content}}</li>',button:'<span id="button_{{:id}}" />'};return{render:function(c,d){return PJF.html.template(a[c],d)}}}(),l=function(){return(new Date).getTime()+"_"+Math.random().toString().substr(2,
5)},t=function(a,c){for(var d=[],b=0;b<a.length;b++){var f=a[b];"selector"===c&&d.push({name:f.itemValue,desc:f.itemName});"auto"===c&&d.push({key:f.itemValue,value:f.itemName})}return d},A=function(a,c){for(var d in c)a[d]=c[d];return a},w=function(a,c,d){d||(d=0);if(c.length>d+1){var b=c[d];a[b]||(a[b]={});w(a[b],c,d+1)}},x=function(a,c){if(a.getType||c.getType)throw"can not merge item";if(s(a)&&s(c))for(var d in c)if(void 0===a[d])a[d]=c[d];else throw"\u5c5e\u6027"+d+"\u51b2\u7a81";else throw"only obj can be merge";
},n=function(a,c,d){d||(d=0);return c.length>d+1?(a=a[c[d]],n(a,c,d+1)):a[c[d]]},y=function(a,c,d,b){b||(b=0);c.length==b+1?a[c[b]]=d:(a=a[c[b]],y(a,c,d,b+1))},q=function(a,c,d,b){w(a,c);var f=n(a,c);if(void 0===f)"Array"===b&&(b=[],b.push(d),d=b),y(a,c,d);else if(s(f)&&"Group"===b)x(f,d);else if(f instanceof Array&&"Array"===b)f.push(d);else throw Error(c.join(".")+"\u58f0\u660e\u7684\u7c7b\u578b\u4e0e\u5b9e\u9645\u4e0d\u7b26");},u=function(a,c){if(a instanceof Array)for(var d=0;d<a.length;d++)u(a[d],
c);else if(a.getType&&"widget"===a.getType())a.execute.apply(a,c);else for(d in a)u(a[d],c)},s=function(a){return a instanceof Object&&!(a instanceof Array)&&!(a instanceof Function)};return{View:{UlContent:function(a){var c=a.el;if(a.groupName){var d=a.groupName;if(a.groupType)var b=a.groupType;else throw Error(" \u5177\u6709groupName\u5c5e\u6027\u65f6groupType\u5c5e\u6027\u5fc5\u586b");}var f=[],g=l(),h=[],e=[];return{addContainer:function(a){e.push(a)},getContainers:function(){return e},addData:function(a){h.push(a);
return a},getDatas:function(){return h},getGroupType:function(){return b},addWidget:function(a){f.push(a);return a},insertHtmlDom:function(){for(var a="",b=0;b<f.length;b++){var g=f[b],d=g.getContainerStyle();d.id=g.getWidgetId();d.content=g.extractHtmlContent();a+=r.render("li",d)}PJF.html.append(c,a);e.forEach(function(a){a.insertHtmlDom()})},instantiate:function(a){for(var b=0;b<f.length;b++){var c=f[b];c.instantiate();a&&a(c)}},getGroupName:function(){return d},getId:function(){return g}}},Widget:function(a){var c=
l(),d={type:"textfield",desc:"",postProcessor:function(){},initialize:function(){},setValuePre:function(a){return a},getValuePost:function(a){return a},containerStyle:{li_class:"",li_style:""},assistButtons:{}};if(a.pjfAttr){var b=A(d,a);b.id=c;b.pjfAttr.dom="dom_"+b.id;b.postProcessor=z[b.type]}else throw Error("\u521d\u59cb\u5316PJF\u7ec4\u4ef6\u7684\u5c5e\u6027\u9700\u653e\u7f6e\u5728pjfAttr\u8282\u70b9\u4e0b");b.buttons instanceof Array&&0<b.buttons.length&&(b.containerStyle={li_class:"width_auto",
li_style:""},a.buttons.forEach(function(a){"defined"===a.type&&(b.assistButtons[l()]={desc:a.desc,onclick:a.onclick})}));return{getWidgetId:function(){return b.id},getContainerStyle:function(){return b.containerStyle},extractHtmlContent:function(){b.desc=b.pjfAttr.required?'<a class="red" id = "star_'+b.id+'">*</a>'+b.desc:'<a class="red" id = "star_'+b.id+'" style="display:none">*</a>'+b.desc;var a=r.render(b.type,{id:b.id,desc:b.desc}),c;for(c in b.assistButtons)a+=r.render("button",{id:c});return a},
instantiate:function(){var a=this;console.log(b.id);b.label=new PJF.ui.label({dom:"label_"+b.id});b.widget=new v[b.type](b.pjfAttr);for(var c in b.assistButtons){var d=b.assistButtons[c];new PJF.ui.linkButton({dom:"button_"+c,name:d.desc,style:"assistant",onclick:function(b){return function(){b(a)}}(d.onclick)})}b.postProcessor();b.initialize()},setRequired:function(a){PJF.html.displayArea("star_"+b.id,a);b.widget.setRequired&&b.widget.setRequired(a)},setDisplay:function(a){PJF.html.displayArea(b.id+
"_container",a)},getValuePost:b.getValuePost,setValuePre:b.setValuePre,getValue:function(){try{return b.widget.getValue()}catch(a){throw Error(b.type+b.id+" has no method getValue");}},setValue:function(a){try{b.widget.setValue(a)}catch(c){throw Error(b.type+b.id+" has no method setValue");}},parseItemsWithKey:function(){var a=[];switch(b.type){case "areaSelector":a.push({key:b.pjfAttr.provinceName,value:{widget:this,setValue:function(a){this.getWidget().execute("setProvinceValue",a)}(),getValue:function(){return this.getWidget().execute("getProvinceValue")}()}});
a.push({key:b.pjfAttr.cityName,value:{widget:this,setValue:function(a){this.getWidget().execute("setCityValue",a)}(),getValue:function(){return this.getWidget().execute("getCityValue")}()}});a.push({key:b.pjfAttr.countyName,value:{widget:this,setValue:function(a){this.getWidget().execute("setCountyValue",a)}(),getValue:function(){return this.getWidget().execute("getCountyValue")}()}});break;default:a.push({key:b.pjfAttr.name,value:pciMVC.Model.Item({widget:this})})}return a},getKey:function(){return b.pjfAttr.name},
getPJFWidget:function(){return b.widget},getType:function(){return"widget"},execute:function(a){if("string"===typeof a){var c=Array.prototype.slice.call(arguments);c.shift();if(this.hasOwnProperty(a))this[a].apply(this,c);else if(b.widget[a]instanceof Function)b.widget[a].apply(b.widget,c);else throw Error(b.type+b.id+" has no method "+a);}}}}},Model:{FormInstantiator:function(a){var c=pciMVC.Model.Form(),d=[],b=function(a,c){if(c&&!a.groupName)throw Error("\u6709groupName\u5c5e\u6027\u7684container\u7684\u4e0b\u7ea7container\u4e5f\u5fc5\u987b\u5177\u6709groupName\u5c5e\u6027");
if("ul"===a.type)for(var d=pciMVC.View.UlContent(a),h=0;h<a.children.length;h++){var g=a.children[h];"widget"===g.category&&d.addWidget(f(g));"data"===g.category&&d.addData(g.attr);"container"===g.category&&d.addContainer(b(g,d.getGroupName()))}return d},f=function(a){var b=pciMVC.View.Widget(a.attr);(a=a.attr.id)&&(m[a]=b);return b};(function(a){if("form"===a.category)for(var c=0;c<a.children.length;c++)d.push(b(a.children[c]))})(a);var g=function(a){var b={};"string"===typeof a.getGroupName()?(a.instantiate(function(a){a.parseItemsWithKey().forEach(function(a){q(b,
a.key.split("."),a.value)})}),a.getDatas().forEach(function(a){q(b,a.name.split("."),pciMVC.Model.Item(a))}),a.getContainers().forEach(function(a){var c=g(a);q(b,a.getGroupName().split("."),c,a.getGroupType())})):(a.instantiate(function(a){a.parseItemsWithKey().forEach(function(a){c.addItem(a.key,a.value)})}),a.getDatas().forEach(function(a){c.addItem(a.name,pciMVC.Model.Item(a))}),a.getContainers().forEach(function(a){var c=g(a);q(b,a.getGroupName().split("."),c,a.getGroupType())}));return b},h=
function(a,b){a.getGroupName()?b.addItemByGroup(a.getGroupName(),g(a)):b.mergerForm(g(a))};for(a=0;a<d.length;a++){var e=d[a];e.insertHtmlDom();h(e,c)}return{getForm:function(){return c},add:function(a){a=b(a);a.insertHtmlDom();h(a,c)}}},Form:function(){var a={},c=function(a){if(a.getValue)return a.getValue();if(s(a)){var b={},d;for(d in a)b[d]=c(a[d]);return b}if(a instanceof Array){b=[];for(d=0;d<a.length;d++)b.push(c(a[d]));return b}return{}},d=function(a,b){a&&a.setValue instanceof Function&&
a.setValue(b)},b=function(a,c){for(var h in c)if(s(c[h]))b(a[h],c[h]);else if(c[h]instanceof Array&&a[h]instanceof Array)for(var e=0;e<c[h].length;e++){var p=c[h][e];p instanceof Object?b(a[h][e],p):d(a[h][e],p)}else d(a[h],c[h])};return{addItem:function(b,c){var d=b.split(".");q(a,d,c)},addItemByGroup:function(b,c){var d=b.split(".");q(a,d,c)},getItems:function(){return a},mergerForm:function(b){x(a,b)},getItemByName:function(b){b=b.split(".");return n(a,b)},getFormData:function(){return c(a)},setFormData:function(c){b(a,
c)},executeInGroup:function(b,c){if(1<arguments.length){var d=Array.prototype.slice.call(arguments);d.shift();var e=b.split("."),e=n(a,e);u(e,d)}},executeByNameList:function(b,c){if(1<arguments.length){var d=Array.prototype.slice.call(arguments);d.shift();for(var e=0;e<b.length;e++){var p=b[e].split("."),p=n(a,p);u(p,d)}}}}},Item:function(a){return a.widget?function(a){var d,b=a.widget,f=a.getValue,g=a.setValue;return{getType:function(){return"widget"},getWidget:function(){return b},execute:function(){var a=
Array.prototype.slice.call(arguments);b.execute.apply(b,a)},setValue:function(a){a=b.setValuePre(a);void 0===d&&(d=a);(g||function(a){b.setValue(a)})(a)},getValue:function(){var a=(f||function(){return b.getValue()})();return b.getValuePost(a)}}}(a):function(a){var d,b=a.defaultValue,f=a.getValuePost||function(a){return a},g=a.setValuePre||function(a){return a};return{getType:function(){return"data"},setValue:function(a){b=g(a);void 0===d&&(d=b)},getValue:function(){return f(b)}}}(a)}},Util:{createNamespace:function(a,
c){var d=c.split(".");(function f(a,c){if(0<c.length){var d=c.shift();a[d]||(a[d]={});f(a[d],c)}})(a,d);return n(a,c.split("."))},getWidgetById:function(a){return m[a]},UnitTest:function(a){var c=[];if(""==a.fwTranId||null==a.fwTranId||void 0==a.fwTranId)return alert("\u4ea4\u6613\u7801\u672a\u586b\u5199"),!1;var d=a.jsonData,b=function(a,d){var e=a.name,f=a.type;try{var k=d[e]}catch(l){}if(void 0==k)c.push("\u5b57\u6bb5\u4e0d\u7b26\uff0c\u8bf7\u6c42\u6570\u636e\u4e2d\u7f3a\u5c11\u3010"+e+"\u3011\u5b57\u6bb5\uff0c\u6216\u4e0a\u9001\u503c\u4e3aundefined");
else if("string"==typeof k)!k instanceof String&&c.push("\u3010"+e+"\u3011\u5b57\u6bb5\u7c7b\u578b\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u63a5\u53e3\u7c7b\u578b\u4e3a:"+a.type),!0!=a.required&&"true"!=a.required||""!=k||c.push("\u3010"+e+"\u3011\u5b57\u6bb5\u4e3a\u5fc5\u586b\u9879\uff0c\u503c\u4e0d\u80fd\u4e3a\u7a7a"),k.length>a.maxLength&&c.push("\u3010"+e+"\u3011\u5b57\u6bb5\u957f\u5ea6\u8d85\u957f\uff0c\u63a5\u53e3\u5141\u8bb8\u6700\u5927\u957f\u5ea6\u4e3a\uff1a"+a.maxLength);else if("Object"==f){if(!k instanceof
Object&&c.push("\u3010"+e+"\u3011\u5b57\u6bb5\u7c7b\u578b\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u63a5\u53e3\u7c7b\u578b\u4e3a:"+a.type),"object"==typeof k)for(var m in a.children)b(a.children[m],k)}else if("Array"==f)for(!k instanceof Array&&c.push("\u3010"+e+"\u3011\u5b57\u6bb5\u7c7b\u578b\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u63a5\u53e3\u7c7b\u578b\u4e3a:"+a.type),e=0;e<k.length;e++)for(var n in a.children)b(a.children[n],k[e])};(function(a){for(var c in a)b(a[c],d)})([{name:"test",type:"String",maxLength:10,
required:!0},{name:"test1",type:"String",maxLength:10,required:!0},{type:"Object",name:"grp2",children:[{name:"group1",type:"String",maxLength:20,required:!0},{name:"group2",type:"String",maxLength:20,required:!0}]},{type:"Array",name:"grp1",children:[{name:"group5",type:"String",maxLength:20,required:!0},{name:"group4",type:"String",maxLength:20,required:!0}]}]);if(0<c.length){a=document.createElement("div");a.setAttribute("style","width:100%;height:auto;");document.body.appendChild(a);a.innerHTML=
"<span style='font-size:13px;line-height:30px;display:block;color:#FFFFFF;background:rgb(43, 129, 175);';><span style='padding-left:30px;'>\u6321\u677f\u6d4b\u8bd5\u9519\u8bef\u63d0\u793a</span></span>";for(var f in c)a.innerHTML+="<div style='background:rgb(210, 224, 230);line-height:25px;color:#2b81af'><span style='color:red;margin-left:30px;'>*&nbsp;</span>"+c[f]+"</div>"}else a.callback("\u56de\u8c03\u51fd\u6570\u6570\u636e")}}}});
